# Styleguide при проектировании API

## Структура проекта

* **models** - папка с моделями, используемыми в API
* **reference** - папка с файлами определениями API
* **documentation** - папка с регламентами ведения работ
* **codegen** - папка с шаблонами для кодогенерации 
* **openapi-merge.config.json** - файл с настройками для слияния нескольких файлов определения API
---

## Структура папки models

* **common** - папка с core-моделями системы. Под core-моделями понимаем сущности, которые могут быть использованы как строительные блоки для других моделей, например, Phone (номер телефона), Email (e-mail пользователя), FirstName (имя пользователя), Skills (навыки пользователя), CommonId (ID)

---

## Нейминг папок и файлов

* Названия папок пишем в **kebab-case**
* Названия файлов пишем в **CamelCase**
* Названия файлов в папке **common** пишем без суффикса в конце имени. Например - *Phone, Email, FullName*
* Названия файлов моделей в других папках пишутся с суффиксом Model. Например - *ProfileModel, EventCalendarModel*.
* Названия файлов моделей с определением ответа от сервера пишутся с суффиксом Response. Например - *EventListResponse, PostsListResponse, CategoryListResponse*.
* Названия файлов моделей с определением тела запроса к серверу пишутся с суффиксом Body. Например - EventBody, ProfileBody

---

## Нейминг полей моделей

* Названия полей моделей пишем в **camelCase**
* Все поля моделей обязательно должны иметь описание (поле description)
* Названия полей, описывающих списки сущностей (например гранулы, занятия, навыки), должны называться в множественном числе. Пример: granules, lessons, skills, attachments
* Названия полей, описывающих булевые значения (флаги завершения, обновления и пр.), должны начинаться с приставки is / has. Например: isCompleted, isFinished, hasYourAnswer
* Названия полей, описывающих вложенную сущность (последний ответ, пользователь), должны называться в единственном числе и [совпадать с именем вложенной модели либо четко в своем имени отражать то, что это за модель]. Пример: user, lastAnswer
* Названия полей, описывающих данные в формате даты/времени, необходимо в имени добавлять суффикс Date / Time. Например: createdTime, answerDate

---

## Файловая структура

Файловая структура должна копировать структуру роутов в  API
Например:
```
/backend/api/admin/qna/experts => admin / qna / experts
```

---

## ВАЖНО. 

### Проверка качества

При внесении изменений в файлы моделей обязательно проверяем качество и валидность нашего кода с помощью команды

```bash
npm run lint		## запуск линтера
```

### OperationID

Не забываем указывать параметр `operationID` для эндпоинтов (если вы не укажите, то вам подскажет об этом линтер). Из имени `operationID` впоследствии формируется имя метода в момент кодогенерации. Например
operationID: ```sign_in => signIn```
Имя operationID должно быть уникально и должно писаться в стиле **camelCase** и отражать цель, которая поставлена перед данным эндпоинтом. Например:

```
[GET] /backend/api/blog/posts/{id} - getProjectById
```

---

### OperationID для GET методов

При выборе имени используем следующий подход
```
get + название сущности = getSubscriptions
get + название сущности + by + поля = getSubscriptionsByRole
```

### OperationID для POST методов

При выборе имени используем следующий подход
```
create + название сущности = createUser
```

### OperationID для PUT методов

При выборе имени используем следующий подход
```
update + название сущности = updateUser
```

### OperationID для PATCH методов

При выборе имени используем следующий подход
```
update + название сущности = updateUser // если поля обновляются
replace + название сущности = replaceUser // если изменяется состав полей
```

### OperationID для DELETE методов

При выборе имени используем следующий подход
```
remove + название сущности = removeUser
```

---

## Описание моделей

В описании каждой модели должны присутствовать поля `title` и `description`.
Поле title формирует в последствии имя файла модели а description - описание модели в моменте кодогенерации. Также они используются как элементы документирование самой модели.

Каждое поле модели должно иметь поле description, поясняющее назначение данного поля в рамках модели.

---

## Использование примеров моделей

Примеры для моделей должны находиться в файлах с моделями,а не в файлах определения API
Примеры описываются с помощью поля x-examples
Для подключения примеров в файл определения API используйте поле examples для конкретного эндпоинта:

```yaml
examples:
  example-task:
    value:
	  $ref: ../models/LastOpenedLessonItem.yaml#/x-examples/example-task
```

## Настройка генерации примеров

Для настройки генерации примеров ответов для prism-cli следует использовать поле x-faker. В нем мы должны указать имя метода из библиотеки [fakerjs.dev ](https://fakerjs.dev/)

```yaml
description:
  type: string
  description: Описание товара
  x-faker: commerce.productDescription
```

Если необходимо указать параметры для метода, то это можно сделать следующим образом: 

```yaml
title: Email
type: string
description: Email
format: email
x-faker:
  internet.email:
    - null
    - null
    - 'netology.ru'
```

---

## Статусы ответов для эндпоинтов. GET

* **200** - Все ок, отдается ответ
* **400** - Плохой запрос (возможно не все параметры переданы, или не верный тип параметров)
* **401** - Пользователь не авторизован
* **403** - Запрещено
* **404** - Нет данных
* **405** - Для методов которые вышли из обращения


## Статусы ответов для эндпоинтов. POST

* **201** - Все ок, сущность была создана
* **400** - Плохой запрос (возможно не все параметры переданы, или не верный тип параметров)
* **401** - Пользователь не авторизован
* **403** - Запрещено
* **404** - Нет данных
* **405** - Для методов которые вышли из обращения


## Статусы ответов для эндпоинтов. PUT

* **200** - Все ок, сущность была создана
* **400** - Плохой запрос (возможно не все параметры переданы, или не верный тип параметров)
* **401** - Пользователь не авторизован
* **403** - Запрещено
* **404** - Нет данных
* **405** - Для методов которые вышли из обращения


## Статусы ответов для эндпоинтов. PATCH

* **200** - Все ок, сущность была обновлена (структура сущности была изменена)
* **204** - Все ок, сущность была обновлена (без изменения структуры)
* **400** - Плохой запрос (возможно не все параметры переданы, или не верный тип параметров)
* **401** - Пользователь не авторизован
* **403** - Запрещено
* **404** - Нет данных
* **405** - Для методов которые вышли из обращения


## Статусы ответов для эндпоинтов. DELETE

* **200** - Все ок, сущность была удалена (сама сущность возвращается в ответе)
* **204** - Все ок, сущность была удалена 
* **400** - Плохой запрос (возможно не все параметры переданы, или не верный тип параметров)
* **401** - Пользователь не авторизован
* **403** - Запрещено
* **404** - Нет данных
* **405** - Для методов которые вышли из обращения